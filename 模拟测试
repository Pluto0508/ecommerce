
-- 为BOSS角色授权（管理整个数据库）
GRANT ALL PRIVILEGES ON `e_commerce_db`.* TO 'BOSS' ;
GRANT SHOW DATABASES ON *.* TO 'BOSS';

-- 为CARGO_MANAGER角色授权（管理产品和库存）
GRANT ALL PRIVILEGES ON `e_commerce_db`.`PRODUCTS` TO 'CARGO_MANAGER';
GRANT ALL PRIVILEGES ON `e_commerce_db`.`INVENTORY` TO 'CARGO_MANAGER';
GRANT SHOW VIEW ON `e_commerce_db`.* TO 'CARGO_MANAGER';
GRANT USAGE ON `e_commerce_db`.* TO 'CARGO_MANAGER';
GRANT SHOW DATABASES ON *.* TO 'CARGO_MANAGER';

-- 为COMMODITY_TRADER角色授权（管理交易、策略和用户）
GRANT ALL PRIVILEGES ON `e_commerce_db`.`PRODUCTS` TO 'COMMODITY_TRADER';
GRANT ALL PRIVILEGES ON `e_commerce_db`.`TRANSACTIONS` TO 'COMMODITY_TRADER';
GRANT ALL PRIVILEGES ON `e_commerce_db`.`TRANSACTION_DETAILS` TO 'COMMODITY_TRADER';
GRANT ALL PRIVILEGES ON `e_commerce_db`.`SUBSIDY_POLICIES` TO 'COMMODITY_TRADER';
GRANT ALL PRIVILEGES ON `e_commerce_db`.`DISCOUNT_POLICIES` TO 'COMMODITY_TRADER';
GRANT ALL PRIVILEGES ON `e_commerce_db`.`USERS` TO 'COMMODITY_TRADER';
GRANT SHOW VIEW ON `e_commerce_db`.* TO 'COMMODITY_TRADER';
GRANT USAGE ON `e_commerce_db`.* TO 'COMMODITY_TRADER';
GRANT SHOW DATABASES ON *.* TO 'COMMODITY_TRADER';

-- 为AUDITOR角色授权（审计日志管理）
GRANT ALL PRIVILEGES ON `e_commerce_db`.`AUDIT_LOGS` TO 'AUDITOR';
GRANT SHOW VIEW ON `e_commerce_db`.* TO 'AUDITOR';
GRANT USAGE ON `e_commerce_db`.* TO 'AUDITOR';
GRANT SHOW DATABASES ON *.* TO 'AUDITOR';

-- 为CUSTOMER角色授权（只读权限）
GRANT SELECT ON `e_commerce_db`.`PRODUCTS` TO 'CUSTOMER';
GRANT SELECT ON `e_commerce_db`.`DISCOUNT_POLICIES` TO 'CUSTOMER';
GRANT SHOW VIEW ON `e_commerce_db`.* TO 'CUSTOMER';
GRANT USAGE ON `e_commerce_db`.* TO 'CUSTOMER';
GRANT SHOW DATABASES ON *.* TO 'CUSTOMER';

-- 刷新权限
FLUSH PRIVILEGES;
-- ----------------------------------------------------------------------------------------------


-- 创建用户并分配角色
CREATE USER IF NOT EXISTS 'boss'@'%' IDENTIFIED BY '123';
CREATE USER IF NOT EXISTS 'cargo_manager'@'%' IDENTIFIED BY '123';
CREATE USER IF NOT EXISTS 'commodity_trader'@'%' IDENTIFIED BY '123';
CREATE USER IF NOT EXISTS 'auditor'@'%' IDENTIFIED BY '123';
CREATE USER IF NOT EXISTS 'customer'@'%' IDENTIFIED BY '123';

-- 授予角色权限
GRANT 'BOSS' TO 'boss'@'%';
GRANT 'CARGO_MANAGER' TO 'cargo_manager'@'%';
GRANT 'COMMODITY_TRADER' TO 'commodity_trader'@'%';
GRANT 'AUDITOR' TO 'auditor'@'%';
GRANT 'CUSTOMER' TO 'customer'@'%';

-- 设置默认角色
ALTER USER 'boss'@'%' DEFAULT ROLE 'BOSS';
ALTER USER 'cargo_manager'@'%' DEFAULT ROLE 'CARGO_MANAGER';
ALTER USER 'commodity_trader'@'%' DEFAULT ROLE 'COMMODITY_TRADER';
ALTER USER 'auditor'@'%' DEFAULT ROLE 'AUDITOR';
ALTER USER 'customer'@'%' DEFAULT ROLE 'CUSTOMER';

-- 刷新权限
FLUSH PRIVILEGES;
